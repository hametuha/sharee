{"version":3,"sources":["bank-helper.js"],"names":["jQuery","document","ready","$","toggleSelect2","bankCode","val","prop","test","select2","ajax","delay","url","dataType","params","query","name","term","BankHelper","apiKey","processResults","data","length","results","map","item","id","text","on","event","code","trigger","xhr","beforeSend","this","split","urls","join","replace","yolpKey","remove","click","e","preventDefault","type","appid","done","response","Feature","Property","Address","alert"],"mappings":"aAIAA,OAAAC,UAAAC,MAAA,SAAAC,GAIE,SAAAC,IAGG,IAAMC,EAAWF,EAAG,qBAAsBG,MAD7CH,EAAMC,iBAAgBG,KAAhBH,YAAgB,MAAWI,KAAAH,IAMjCF,EAAA,gBAAAM,QAAA,CACGC,KAAA,CACDA,MAAM,IACJC,IAAAA,+CACAC,SAAK,QACLC,KAAAA,SAAUC,GACJC,EAAA,CACJC,KAAMD,EAAQE,MAKb,OALDC,WAAAC,SAGAJ,EAAKG,OAAWC,WAASA,QAExBJ,GAEFK,eAZG,SAAAC,GAaJD,OAAAA,EAAAA,KAAgBE,OAGb,CACDC,QAAOF,EAAAA,KAAAG,IAAA,SAAAC,GACLF,MAASF,CACPK,GAAAD,EAAOT,KACLU,KAAID,EAAKT,KACTW,KAAMF,EAAKT,SAPVK,CAAKA,QAAKC,QAdfM,GAAA,iBAAA,SAAAC,GADR1B,EAAA,qBA6ByBG,IAAAuB,EAAUA,OAAQR,KAAAS,MAAAC,QAAA,YAI3C5B,EAAA,iBAAAM,QAAA,CACGC,KAAA,CACDA,MAAM,IACJC,IAAAA,oDACAC,SAAK,QACLC,WAAU,SAHNmB,GAIJC,IAAAA,EAAYC,KAAAtB,IAAAuB,MAAA,KACVC,EAAIA,GAAAA,EAAO,GAAKxB,QAAW,SAA3B,IAAAT,EAAA,qBAAAG,OACA8B,KAAKxB,IAAKwB,EAAAC,KAAQC,MAEnBjB,KARG,SAAAP,GASEC,EAAA,CACJC,KAAMD,EAAQE,MAKb,OALDC,WAAAC,SAGAJ,EAAKG,OAAWC,WAASA,QAExBJ,GAEFK,eAjBG,SAAAC,GAkBJD,OAAAA,EAAAA,KAAgBE,OAGb,CACDC,QAAOF,EAAAA,KAAAG,IAAA,SAAAC,GACLF,MAASF,CACPK,GAAAD,EAAOT,KACLU,KAAID,EAAKT,KACTW,KAAMF,EAAKT,SAPVK,CAAKA,QAAKC,QAnBfM,GAAA,iBAAA,SAAAC,GADR1B,EAAA,sBAkCyBG,IAAAuB,EAAAf,OAAkBO,KAAAS,QAI3C1B,IAAAA,EAAAA,qBAAAA,OAAAA,GAGOc,WAAWqB,SAAlBpC,EAAOe,sBAAqBsB,SAE3BrC,EAAA,sBAAAsC,MAAA,SAAAC,GACEA,EAAAC,iBACDD,EAAEC,KAAAA,CACAjC,KAAK,MACLkC,IAAAA,uDACAhC,SAAK,QACLC,KAAAA,CACAQ,MAAMH,WAAAqB,QACJM,MAAO3B,EAAAA,iBADHZ,MAEJS,OAAOZ,UAFH2C,KAAA,SAAAC,GAKCA,EAAUA,SAAWA,EAAAC,QAAA1B,OAI3BnB,EAAA,qBAAAG,IAAAyC,EAAAC,QAAA,GAAAC,SAAAC,SAHDC,MAAOJ,WAASC,aAIhB7C,KAAG,SAAA4C,GAdLI,MAeSjC,WAAU6B","file":"../bank-helper.js","sourcesContent":["/**\n * Description\n */\n\n/*global BankHelper: false*/\n\njQuery( document ).ready( function( $ ) {\n\n  'use strict';\n\n  const toggleSelect2 = function() {\n     const bankCode = $( '#_bank_group_code' ).val();\n     $( '#_bank_branch' ).prop( 'disabled', ! /\\d+/.test( bankCode ) );\n  };\n\n\n  // Select Bank code.\n  $( '#_bank_group' ).select2({\n    ajax: {\n      delay: 500,\n      url: 'https://bankcode-api.appspot.com/api/bank/JP',\n      dataType: 'jsonp',\n      data: function( params ) {\n        const query = {\n          name: params.term\n        };\n        if ( BankHelper.apiKey ) {\n          query.apiKey = BankHelper.apiKey;\n        }\n        return query;\n      },\n      processResults: function( data ) {\n        if ( ! data.data.length ) {\n          return { results: [] };\n        }\n        return {\n          results: data.data.map( function( item ) {\n            return {\n              id: item.name,\n              text: item.name,\n              code: item.code\n            };\n          })\n        };\n      }\n    }\n  }).on( 'select2:select', function( event ) {\n    $( '#_bank_group_code' ).val( event.params.data.code ).trigger( 'change' );\n  });\n\n  // Select Branch code.\n  $( '#_bank_branch' ).select2({\n    ajax: {\n      delay: 500,\n      url: 'https://bankcode-api.appspot.com/api/bank/JP/0000',\n      dataType: 'jsonp',\n      beforeSend: function( xhr ) {\n        let urls = this.url.split( '?' );\n        urls[0] = urls[0].replace( /\\/\\d+$/, '/' + $( '#_bank_group_code' ).val() );\n        this.url = urls.join( '?' );\n      },\n      data: function( params ) {\n        const query = {\n          name: params.term\n        };\n        if ( BankHelper.apiKey ) {\n          query.apiKey = BankHelper.apiKey;\n        }\n        return query;\n      },\n      processResults: function( data ) {\n        if ( ! data.data.length ) {\n          return { results: [] };\n        }\n        return {\n          results: data.data.map( function( item ) {\n            return {\n              id: item.name,\n              text: item.name,\n              code: item.code\n            };\n          })\n        };\n      }\n    }\n  }).on( 'select2:select', function( event ) {\n    $( '#_bank_branch_code' ).val( event.params.data.code );\n  });\n\n  toggleSelect2();\n  $( '#_bank_group_code' ).change( toggleSelect2 );\n\n  if ( ! BankHelper.yolpKey ) {\n    $( '#sharee-zip-search' ).remove();\n  }\n  $( '#sharee-zip-search' ).click( function( e ) {\n    e.preventDefault();\n    $.ajax({\n      type: 'GET',\n      url: 'https://map.yahooapis.jp/search/zip/V1/zipCodeSearch',\n      dataType: 'jsonp',\n      data: {\n        appid: BankHelper.yolpKey,\n        query: $( '#_billing_zip' ).val(),\n        output: 'json'\n      }\n    }).done( function( response ) {\n      if ( ! response.Feature || ! response.Feature.length ) {\n        alert( BankHelper.yolpError );\n        return;\n      }\n      $( '#_billing_address' ).val( response.Feature[0].Property.Address );\n    }).fail( function( response ) {\n      alert( BankHelper.yolpError );\n    });\n  });\n});\n"]}